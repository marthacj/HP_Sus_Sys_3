name: sci-calculation
description: >-
  Calculate operational carbon from CPU utilization using the Teads curve and
  then get operational and embodied carbon too. SCI is ISO-recognized standard
  for reporting carbon costs of running software, takes into account all the
  energy used by the application; below includes CPU energy and network energy.
initialize:
  outputs:
    - yaml
  plugins:
    group-by:
      path: builtin
      method: GroupBy
    gpu-utilisation-percentage-to-decimal:
      method: Divide
      path: builtin
      global-config:
        numerator: gpu/utilization
        denominator: 100
        output: gpu-utilization
    gpu-utilisation-to-wattage:
      method: Multiply
      path: builtin
      global-config:
        input-parameters:
          - gpu-utilization
          - max-gpu-wattage
        output-parameter: gpu-wattage
    gpu-wattage-times-duration:
      method: Multiply
      path: builtin
      global-config:
        input-parameters:
          - gpu-wattage
          - duration
        output-parameter: gpu-wattage-times-duration
    gpu-wattage-to-energy-kwh:
      method: Divide
      path: builtin
      global-config:
        numerator: gpu-wattage-times-duration
        denominator: 3600000
        output: gpu/energy
    cpu-utilisation-percentage-to-decimal:
      method: Divide
      path: builtin
      global-config:
        numerator: cpu/utilization
        denominator: 100
        output: cpu-utilization
    cpu-utilisation-to-wattage:
      method: Multiply
      path: builtin
      global-config:
        input-parameters:
          - cpu-utilization
          - cpu/thermal-design-power
        output-parameter: cpu-wattage
    cpu-wattage-times-duration:
      method: Multiply
      path: builtin
      global-config:
        input-parameters:
          - cpu-wattage
          - duration
        output-parameter: cpu-wattage-times-duration
    cpu-wattage-to-energy-kwh:
      method: Divide
      path: builtin
      global-config:
        numerator: cpu-wattage-times-duration
        denominator: 3600000
        output: cpu-energy-raw
    calculate-vcpu-ratio:
      method: Divide
      path: builtin
      global-config:
        numerator: vcpus-allocated
        denominator: vcpus-total
        output: vcpu-ratio
    correct-cpu-energy-for-vcpu-ratio:
      method: Divide
      path: builtin
      global-config:
        numerator: cpu-energy-raw
        denominator: vcpu-ratio
        output: cpu/energy
    energy-sent:
      method: Multiply
      path: builtin
      global-config:
        input-parameters:
          - total-MB-sent
          - network-intensity
        output-parameter: energy-sent-joules
    energy-received:
      method: Multiply
      path: builtin
      global-config:
        input-parameters:
          - total-MB-received
          - network-intensity
        output-parameter: energy-received-joules
    sum-network-energy-joules:
      method: Sum
      path: builtin
      global-config:
        input-parameters:
          - energy-sent-joules
          - energy-received-joules
        output-parameter: total-energy-network-joules
    total-network-energy-to-kwh:
      method: Divide
      path: builtin
      global-config:
        numerator: total-energy-network-joules
        denominator: 3600000
        output: network/energy
    sum-energy-components:
      path: builtin
      method: Sum
      global-config:
        input-parameters:
          - cpu/energy
          - gpu/energy
          - network/energy
        output-parameter: energy
    sci-embodied:
      method: SciEmbodied
      path: builtin
    operational-carbon:
      path: builtin
      method: Multiply
      global-config:
        input-parameters:
          - energy
          - grid/carbon-intensity
        output-parameter: carbon-operational
    sum-carbon:
      path: builtin
      method: Sum
      global-config:
        input-parameters:
          - carbon-operational
          - carbon-embodied
        output-parameter: carbon
    sci:
      path: builtin
      method: Sci
      global-config:
        functional-unit: machine
execution:
  status: fail
  command: >-
    C:\Program Files\nodejs\node.exe
    C:\Users\martha.calder-jones\AppData\Roaming\npm\node_modules\@grnsft\if\build\index.js
    --manifest C:\Users\martha.calder-jones\OneDrive - University College
    London\UCL_comp_sci\Sustainable_Systems_3\HP_Sus_Sys_3\manifest1\z2_G4_Sci_scores.yaml
    --output C:\Users\martha.calder-jones\OneDrive - University College
    London\UCL_comp_sci\Sustainable_Systems_3\HP_Sus_Sys_3\manifest1\outputs\z2_G4_Sci_Scores_Output
  environment:
    if-version: 0.4.0
    os: "Microsoft Windows 10 Enterprise\r"
    os-version: 10.0.19045 N/A Build 19045
    node-version: 20.14.0
    date-time: 2024-07-30T13:20:07.885Z (UTC)
    dependencies: []
  error: >-
    PluginInitalizationError: Not initalized plugin: tdp-finder. Check if
    tdp-finder is in 'manifest.initalize.plugins'.
tree:
  children:
    child:
      pipeline:
        - group-by
        - tdp-finder
        - gpu-utilisation-percentage-to-decimal
        - gpu-utilisation-to-wattage
        - gpu-wattage-times-duration
        - gpu-wattage-to-energy-kwh
        - cpu-utilisation-percentage-to-decimal
        - cpu-utilisation-to-wattage
        - cpu-wattage-times-duration
        - cpu-wattage-to-energy-kwh
        - calculate-vcpu-ratio
        - correct-cpu-energy-for-vcpu-ratio
        - energy-sent
        - energy-received
        - sum-network-energy-joules
        - total-network-energy-to-kwh
        - sum-energy-components
        - sci-embodied
        - operational-carbon
        - sum-carbon
        - sci
      config:
        group-by:
          group:
            - instance-type
            - machine-code
      defaults:
        time-reserved: 157788000
        grid/carbon-intensity: 31
        device/expected-lifespan: 157788000
        resources-reserved: vcpus-allocated
        resources-total: vcpus-total
        machine: 1
        duration: 216000
        network-intensity: 0.000124
      inputs:
        - timestamp: 2024-07-14T00:00:00.000Z
          device/emissions-embodied: 370.14
          cpu/thermal-design-power: 90
          vcpus-total: 24
          vcpus-allocated: 24
          cpu/utilization: 0.0807847747114039
          max-cpu-wattage: 280
          gpu/utilization: 1
          max-gpu-wattage: 70
          total-MB-sent: 832.184668377887
          total-MB-received: 1446.80422965691
          instance-type: z2 mini
          machine-code: ld71r18u44dws
        - timestamp: 2024-07-14T00:00:00.000Z
          device/emissions-embodied: 306
          cpu/thermal-design-power: 165
          vcpus-total: 28
          vcpus-allocated: 28
          cpu/utilization: 0.132013670350801
          max-cpu-wattage: 1400
          gpu/utilization: 0.00512820512820513
          max-gpu-wattage: 230
          total-MB-sent: 632.026554806753
          total-MB-received: 1529.86247233888
          instance-type: Z4R G4
          machine-code: ld71r16u15ws
        - timestamp: 2024-07-14T00:00:00.000Z
          device/emissions-embodied: 370.14
          cpu/thermal-design-power: 90
          vcpus-total: 24
          vcpus-allocated: 24
          cpu/utilization: 2.37467511109085
          max-cpu-wattage: 280
          gpu/utilization: 4.12108773730133
          max-gpu-wattage: 70
          total-MB-sent: 3757.86334155826
          total-MB-received: 3770.94036641613
          instance-type: z2 mini
          machine-code: ld71r18u44fws
        - timestamp: 2024-07-14T00:00:00.000Z
          device/emissions-embodied: 306
          cpu/thermal-design-power: 165
          vcpus-total: 28
          vcpus-allocated: 28
          cpu/utilization: 0.128619426852723
          max-cpu-wattage: 1400
          gpu/utilization: 0.00461538461538461
          max-gpu-wattage: 230
          total-MB-sent: 859.6917818946
          total-MB-received: 2707.83639127929
          instance-type: Z4R G4
          machine-code: ld71r16u13ws
        - timestamp: 2024-07-14T00:00:00.000Z
          device/emissions-embodied: 370.14
          cpu/thermal-design-power: 90
          vcpus-total: 24
          vcpus-allocated: 24
          cpu/utilization: 0.445829334339081
          max-cpu-wattage: 280
          gpu/utilization: 0.715238583889173
          max-gpu-wattage: 70
          total-MB-sent: 803.944674633178
          total-MB-received: 17003.1703111677
          instance-type: z2 mini
          machine-code: ld71r18u44bws
        - timestamp: 2024-07-14T00:00:00.000Z
          device/emissions-embodied: 370.14
          cpu/thermal-design-power: 90
          vcpus-total: 24
          vcpus-allocated: 24
          cpu/utilization: 0.0908625039434838
          max-cpu-wattage: 280
          gpu/utilization: 0.00564102564102564
          max-gpu-wattage: 70
          total-MB-sent: 1907.20354116066
          total-MB-received: 2480.27632522669
          instance-type: z2 mini
          machine-code: ld71r18u44cws
        - timestamp: 2024-07-14T00:00:00.000Z
          device/emissions-embodied: 306
          cpu/thermal-design-power: 165
          vcpus-total: 28
          vcpus-allocated: 28
          cpu/utilization: 0.135559799044188
          max-cpu-wattage: 1400
          gpu/utilization: 0.00307692307692308
          max-gpu-wattage: 230
          total-MB-sent: 1063.41255565625
          total-MB-received: 2309.49060360773
          instance-type: Z4R G4
          machine-code: ld71r16u14ws
        - timestamp: 2024-07-14T00:00:00.000Z
          device/emissions-embodied: 370.14
          cpu/thermal-design-power: 90
          vcpus-total: 24
          vcpus-allocated: 24
          cpu/utilization: 0.821035114414244
          max-cpu-wattage: 280
          gpu/utilization: 1
          max-gpu-wattage: 70
          total-MB-sent: 216.133438504292
          total-MB-received: 360.314345591167
          instance-type: z2 mini
          machine-code: ld71r18u44ews
