description: "Calculate operational carbon from CPU utilization using the Teads curve\
  \ and then get operational and embodied carbon too. \n            SCI is ISO-recognized\
  \ standard for reporting carbon costs of running software, takes into account all\
  \ the energy used by the application; below includes CPU energy and network energy."
initialize:
  outputs:
  - yaml
  plugins:
    calculate-vcpu-ratio:
      global-config:
        denominator: vcpus-total
        numerator: vcpus-allocated
        output: vcpu-ratio
      method: Divide
      path: builtin
    correct-cpu-energy-for-vcpu-ratio:
      global-config:
        denominator: vcpu-ratio
        numerator: cpu-energy-raw
        output: cpu/energy
      method: Divide
      path: builtin
    cpu-utilisation-percentage-to-decimal:
      global-config:
        denominator: 100
        numerator: cpu/utilization
        output: cpu-utilization
      method: Divide
      path: builtin
    cpu-utilisation-to-wattage:
      global-config:
        input-parameters:
        - cpu-utilization
        - cpu/thermal-design-power
        output-parameter: cpu-wattage
      method: Multiply
      path: builtin
    cpu-wattage-times-duration:
      global-config:
        input-parameters:
        - cpu-wattage
        - duration
        output-parameter: cpu-wattage-times-duration
      method: Multiply
      path: builtin
    cpu-wattage-to-energy-kwh:
      global-config:
        denominator: 3600000
        numerator: cpu-wattage-times-duration
        output: cpu-energy-raw
      method: Divide
      path: builtin
    energy-received:
      global-config:
        input-parameters:
        - total-MB-received
        - network-intensity
        output-parameter: energy-received-joules
      method: Multiply
      path: builtin
    energy-sent:
      global-config:
        input-parameters:
        - total-MB-sent
        - network-intensity
        output-parameter: energy-sent-joules
      method: Multiply
      path: builtin
    gpu-utilisation-percentage-to-decimal:
      global-config:
        denominator: 100
        numerator: gpu/utilization
        output: gpu-utilization
      method: Divide
      path: builtin
    gpu-utilisation-to-wattage:
      global-config:
        input-parameters:
        - gpu-utilization
        - max-gpu-wattage
        output-parameter: gpu-wattage
      method: Multiply
      path: builtin
    gpu-wattage-times-duration:
      global-config:
        input-parameters:
        - gpu-wattage
        - duration
        output-parameter: gpu-wattage-times-duration
      method: Multiply
      path: builtin
    gpu-wattage-to-energy-kwh:
      global-config:
        denominator: 3600000
        numerator: gpu-wattage-times-duration
        output: gpu/energy
      method: Divide
      path: builtin
    group-by:
      method: GroupBy
      path: builtin
    operational-carbon:
      global-config:
        input-parameters:
        - energy
        - grid/carbon-intensity
        output-parameter: carbon-operational
      method: Multiply
      path: builtin
    sci:
      global-config:
        functional-unit: machine
      method: Sci
      path: builtin
    sci-embodied:
      method: SciEmbodied
      path: builtin
    sum-carbon:
      global-config:
        input-parameters:
        - carbon-operational
        - carbon-embodied
        output-parameter: carbon
      method: Sum
      path: builtin
    sum-energy-components:
      global-config:
        input-parameters:
        - cpu/energy
        - gpu/energy
        - network/energy
        output-parameter: energy
      method: Sum
      path: builtin
    sum-network-energy-joules:
      global-config:
        input-parameters:
        - energy-sent-joules
        - energy-received-joules
        output-parameter: total-energy-network-joules
      method: Sum
      path: builtin
    tdp-finder:
      global-config:
        filepath: C:\Users\martha.calder-jones\OneDrive - University College London\UCL_comp_sci\Sustainable_Systems_3\HP_Sus_Sys_3\data\modified_CSV1038-0610-0614-day.csv
        output:
        - - cores
          - num-cores
        - - CPU_average
          - cpu/utilization
        - - GPU_average
          - gpu/utilization
        - - Total_MB_Sent
          - total-MB-sent
        - - Total_MB_Received
          - total-MB-received
        query:
          host: instance-type
      method: CSVLookup
      path: builtin
    total-network-energy-to-kwh:
      global-config:
        denominator: 3600000
        numerator: total-energy-network-joules
        output: network/energy
      method: Divide
      path: builtin
name: sci-calculation
tree:
  children:
    child:
      config:
        group-by:
          group:
          - instance-type
          - cores
      defaults:
      - time-reserved: 157788000
      - grid/carbon-intensity: 31
      - device/expected-lifespan: 157788000
      - resources-reserved: vcpus-allocated
      - resources-total: vcpus-total
      - machine: 1
      - duration: 216000
      - network-intensity: 0.000124
      - timestamp: 2024-06-09 23:00:00
      pipeline:
      - tdp-finder
      - group-by
      - gpu-utilisation-percentage-to-decimal
      - gpu-utilisation-to-wattage
      - gpu-wattage-times-duration
      - gpu-wattage-to-energy-kwh
      - cpu-utilisation-percentage-to-decimal
      - cpu-utilisation-to-wattage
      - cpu-wattage-times-duration
      - cpu-wattage-to-energy-kwh
      - calculate-vcpu-ratio
      - correct-cpu-energy-for-vcpu-ratio
      - energy-sent
      - energy-received
      - sum-network-energy-joules
      - total-network-energy-to-kwh
      - sum-energy-components
      - sci-embodied
      - operational-carbon
      - sum-carbon
      - sci
    inputs:
    - instance-type: ld71r18u44dws
